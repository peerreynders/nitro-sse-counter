!function(){"use strict";
/*! (c) Andrea Giammarchi - ISC */const e=!0,t=!1,s="querySelectorAll",n="querySelectorAll",{document:r,Element:o,MutationObserver:i,Set:c,WeakMap:a}=self,u=e=>n in e,{filter:d}=[];const l=new Map,b=[],v=self.document,f=(l=>{const b=new a,v=(e,t)=>{let s;if(t)for(let n,r=(e=>e.matches||e.webkitMatchesSelector||e.msMatchesSelector)(e),o=0,{length:i}=h;o<i;o++)r.call(e,n=h[o])&&(b.has(e)||b.set(e,new c),s=b.get(e),s.has(n)||(s.add(n),l.handle(e,t,n)));else b.has(e)&&(s=b.get(e),b.delete(e),s.forEach((s=>{l.handle(e,t,s)})))},f=(e,t=!0)=>{for(let s=0,{length:n}=e;s<n;s++)v(e[s],t)},{query:h}=l,m=l.root||r,A=((n,r=document,o=MutationObserver,i=["*"])=>{const c=(t,r,o,i,a,u)=>{for(const d of t)(u||s in d)&&(a?o.has(d)||(o.add(d),i.delete(d),n(d,a)):i.has(d)||(i.add(d),o.delete(d),n(d,a)),u||c(d[s](r),r,o,i,a,e))},a=new o((s=>{if(i.length){const n=i.join(","),r=new Set,o=new Set;for(const{addedNodes:i,removedNodes:a}of s)c(a,n,r,o,t,t),c(i,n,r,o,e,t)}})),{observe:u}=a;return(a.observe=t=>u.call(a,t,{subtree:e,childList:e}))(r),a})(v,m,i,h),{attachShadow:k}=o.prototype;return k&&(o.prototype.attachShadow=function(e){const t=k.call(this,e);return A.observe(t),t}),h.length&&f(m[n](h)),{drop:e=>{for(let t=0,{length:s}=e;t<s;t++)b.delete(e[t])},flush:()=>{const e=A.takeRecords();for(let t=0,{length:s}=e;t<s;t++)f(d.call(e[t].removedNodes,u),!1),f(d.call(e[t].addedNodes,u),!0)},observer:A,parse:f}})({query:b,root:v,handle(e,t,s){const n=l.get(s);n&&(t?n.mounted:n.unmounted)?.(e)}}),h=(e,t)=>{const s="."+e;b.includes(s)||(b.push(s),l.set(s,t),f.parse(v.querySelectorAll(s)))},m={UNAVAILABLE:-1,WAIT:0,READY:1},A="js:c-count--disabled";function k(e,t){const s=new WeakMap;return{mounted(n){if(!(n instanceof HTMLElement))return;const r={root:n,disabled:n.classList.contains(A),unsubscribes:[]};r.unsubscribes[0]=e((e=>function(e,t){e.root.textContent=String(t)}(r,e))),r.unsubscribes[1]=t((e=>function(e,t){t!==m.UNAVAILABLE?e.disabled&&(e.disabled=!1,e.root.classList.remove(A)):e.disabled||(e.disabled=!0,e.root.classList.add(A))}(r,e))),s.set(n,r)},unmounted(e){const t=s.get(e);if(t){for(const e of t.unsubscribes)e();s.delete(e)}}}}const L="js:c-status--error",g=()=>{};function E(e){const t=new WeakMap;return{mounted(s){if(!(s instanceof HTMLParagraphElement))return;const n={root:s,unsubscribe:g};n.unsubscribe=e((e=>function(e,t){t.error&&e.root.classList.add(L),e.root.textContent=t.message}(n,e))),t.set(s,n)},unmounted(e){const s=t.get(e);s&&(s.unsubscribe(),t.delete(e))}}}const p="js:c-trigger--disabled",S="js:c-trigger--wait",w=()=>{};function N(e,t){const s=new WeakMap;return{mounted(n){if(!(n instanceof HTMLButtonElement))return;const r={root:n,disabled:!1,click:()=>{r.disabled||e()},unsubscribe:w};r.unsubscribe=t((e=>function(e,t){switch(console.log("trigger",t,e.root),t){case m.UNAVAILABLE:return e.root.classList.remove(S),e.disabled=!0,e.root.classList.add(p),void e.root.setAttribute("aria-disabled","true");case m.WAIT:return e.root.classList.add(S),e.disabled=!0,e.root.classList.add(p),void e.root.setAttribute("aria-disabled","true");default:return e.root.classList.remove(S),e.disabled=!1,e.root.classList.remove(p),void e.root.removeAttribute("aria-disabled")}}(r,e))),s.set(n,r),r.root.addEventListener("click",r.click)},unmounted(e){const t=s.get(e);t&&(t.unsubscribe(),t.root.removeEventListener("click",t.click),s.delete(e))}}}function M(e,t){e.addEventListener("message",t),e.addEventListener("error",t)}function y(e){const t={status:void 0,href:e,sink:void 0,source:void 0,handleEvent(e){var t;if(console.log("handleEvent",e),this.sink&&!1!==this.status)return e instanceof MessageEvent?(this.status=!0,void function(e,t){const s=Number(t.data);if(Number.isNaN(s))return;e({kind:"update",count:s})}(this.sink,e)):void("error"===e.type&&(!0===this.status?(0,this.sink)({kind:"end"}):function(e){e({kind:"error",reason:"Failed to open connection"})}(this.sink),(t=this).source&&(t.source.removeEventListener("message",t),t.source.removeEventListener("error",t),t.source.readyState<2&&t.source.close()),t.source=void 0,t.sink=void 0,t.status=!1))}};return{start:()=>{t.source=new EventSource(t.href),t.sink&&M(t.source,t)},subscribe:e=>{const s=t.sink;return t.sink=e,!s&&t.source&&M(t.source,t),()=>{t.sink===e&&(t.sink=void 0)}}}}class I{sinks=new Set;add=e=>(this.sinks.add(e),()=>{this.sinks.delete(e)});send=e=>{for(const t of this.sinks)t(e)};sendSkip=(e,t)=>{for(const s of this.sinks)s!==t&&s(e)}}function j({inbound:e,outbound:t}){const s=function(){let e;return{send:t=>{e&&e(t)},subscribe:t=>(e=t,()=>{e===t&&(e=void 0)})}}(),n=function(e){let t={error:!0,message:"Connection failed. Reload to retry."};const s=new I,n={available:m.READY,messageSink:e=>{switch(e.kind){case"end":t={error:!1,message:"Count complete. Reload to restart."};break;case"error":break;default:return}n.sendAvailable(m.UNAVAILABLE)},sendAvailable:r=>{t&&(n.available=r,s.send(r),r===m.UNAVAILABLE&&(e(t),t=void 0))},subscribe:e=>{const t=s.add(e);return e(n.available),t}};return n}(s.send),r=function(e,t,s){let n,r;const o=e=>{switch(console.log("MESSAGE",e),e.kind){case"update":return n&&n(e.count),void s(m.READY);case"error":case"end":return r&&r(),void t(e)}},i={subscribe:e=>(n=e,()=>{n===e&&(n=void 0)}),unsubscribe:(()=>{const t=e(o);return()=>{i.unsubscribe=r=void 0,t()}})()};return i}(e.subscribe,n.messageSink,n.sendAvailable),o=function(e,t){const s=e=>{e||t(m.UNAVAILABLE)};let n=!1;return{availableSink:e=>{n||e===m.UNAVAILABLE&&(n=!0)},unsubscribe:void 0,dispatch(){n||(t(m.WAIT),e().then(s))}}}(t.increment,n.sendAvailable);return o.unsubscribe=n.subscribe(o.availableSink),{increment:o.dispatch,start:e.start,subscribeAvailable:n.subscribe,subscribeStatus:s.subscribe,subscribeCount:r.subscribe}}var B,T;B=j({inbound:y("/api/counter"),outbound:(T="/api/increment",{increment:async()=>(await fetch(T,{method:"POST"})).ok})}),h("js\\:c-count",k(B.subscribeCount,B.subscribeAvailable)),h("js\\:c-status",E(B.subscribeStatus)),h("js\\:c-trigger",N(B.increment,B.subscribeAvailable)),B.start()}();
